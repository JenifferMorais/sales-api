version: '3.8'

services:
  # Frontend Angular (Produção)
  frontend:
    image: ghcr.io/${GITHUB_REPOSITORY}/sales-web:latest
    ports:
      - "80:80"
      - "443:443"
    environment:
      - API_URL=${API_URL:-https://sua-api.onrender.com/api}
    volumes:
      # SSL certificates (se usar)
      - ./certs:/etc/nginx/certs:ro
    depends_on:
      - backend
    networks:
      - sales-network
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M

  # Backend Quarkus (Produção)
  backend:
    image: ghcr.io/${GITHUB_REPOSITORY:-seu-usuario/sales-api}:latest
    ports:
      - "8080:8080"
    environment:
      - DB_HOST=${DB_HOST}
      - DB_PORT=${DB_PORT:-5432}
      - DB_NAME=${DB_NAME}
      - DB_USERNAME=${DB_USERNAME}
      - DB_PASSWORD=${DB_PASSWORD}
      - JWT_ISSUER=${JWT_ISSUER}
      - JWT_EXPIRATION_HOURS=${JWT_EXPIRATION_HOURS:-24}
      - JWT_INACTIVITY_TIMEOUT_MINUTES=${JWT_INACTIVITY_TIMEOUT_MINUTES:-15}
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_FROM=${SMTP_FROM}
      - SMTP_USERNAME=${SMTP_USERNAME}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
      - SMTP_MOCK=${SMTP_MOCK:-false}
      - APP_URL=${APP_URL}
    networks:
      - sales-network
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M

networks:
  sales-network:
    driver: bridge
